---
layout: post
title: Adventures in ElasticSearch
category: Technical
---

I'm not dead! I'm just coding, rather than blogging!

Progress on the spike continues apace, although not as apace as I would like. (That would be mainly due to accidentally writing a book, plus other general life things.) Deadlines are slipping but technically I feel on top of and comfortable abut where the direction of the project is going.

There is only one niggling worry in the back of my mind. I started by building an Angular front-end and then hoping to develop the Ionic one in parallel. Indeed at this point they're both sitting in different branches of the same [same git repo](https://github.com/simoncozens/connector-frontend), with the hope not only that code could be shared between the two but even that commits could be merged. However, there doesn't seem to be much likelihood of that happening. On the one hand, the templates are going to be utterly different by nature. So that leaves the backend stuff. But the Ionic backend stuff requires various Ionic-specific modules and components, and they get in the way of the merge history. Add to that the fact that routing is completely different, parameter handling is completely different, and so on, pages are completely different (each Ionic page gets its own NgModule), the only things that are really sharable are things like services and classes. So that sucks. I don't have the brainpower or the manpower to develop both desktop and mobile in parallel, so sadly I am just going to have to go with doing the Ionic app and backporting everything to desktop once it's done.

I'm more or less on top of things like mobile sync, which I thought was going to be a complete pain, and the Salesforce integration looks a lot easier than I thought it was going to be thanks to the existence of nice client libraries. (I had a horrible feeling it was going to involve SOAP and pain, because everything that involves SOAP also involves pain.)

Field-level visibility is sort of done but it now requires an administrative front-end for creating and editing users and putting them into groups, and that is probably going to be desktop-based, and that means... see above. So I have done what I can and I'm going to finesse it for now in the hope that Salesforce integration will mean that all the user-administration stuff can be done within Salesforce. That would make the whole thing someone else's problem, which makes me happy.

So the next thing on my plate is ramping up the search. Now that we have more requirements spec'ced out, it's clear ElasticSearch is the way forward, at least in parallel with Mongodb, and having fiddled with it a bit today, that turns out to be not too difficult to do. mongo-connector will keep the two databases in sync, and it's all hidden away in the back-end behind the Rails API, so who cares if we have two data sources for the same thing. I've got the syncing working locally, but haven't tried deploying on heroku or anywhere else yet. What I need to get working next is having actual ElasticSearch queries, in particular the [More Like This](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html) query, working well. This requires defining an index which handles the terms properly. I plan to do this through the basic [elasticsearch-ruby](https://github.com/elastic/elasticsearch-ruby) module, so that the index is documented and reproducible and there in the codebase. I can then send queries through `elasticsearch-api` and then use the results to pull records out of Mongo. Once *that* works we can start doing clever searches.

How that is going to look in terms of a mobile UI is anyone's guess. I find I'm spending more time working on "getting this to look reasonable on a mobile device" than I am on getting the functionality working at all. And that doesn't sound like a spike; it's starting to sound like an actual project. Heaven help us all.